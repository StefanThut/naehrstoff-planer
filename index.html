<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>N√§hrstoff-Planer</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 0;
    }
    header {
      background: #161b22;
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid #30363d;
    }
    header h1 {
      margin: 0;
      color: #58a6ff;
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: #161b22;
      border-bottom: 1px solid #30363d;
    }
    nav button {
      background: none;
      color: #e6edf3;
      border: none;
      padding: 0.75rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
    }
    nav button.active {
      border-bottom: 2px solid #58a6ff;
      font-weight: bold;
    }
    section {
      display: none;
      padding: 1rem;
    }
    section.active {
      display: block;
    }
    .food-item {
      border-bottom: 1px solid #30363d;
      padding: 0.5rem 0;
    }
    .category {
      font-size: 0.9em;
      color: #8b949e;
    }
  </style>
</head>
<body>
  <header>
    <h1>ü•¶ N√§hrstoff-Planer</h1>
    <p>Ern√§hrung planen, auswerten & verbessern ‚Äì direkt im Browser.</p>
  </header>

  <nav id="tabs">
    <button class="active" data-tab="users">Benutzer</button>
    <button data-tab="foods">Lebensmittel</button>
    <button data-tab="menu">Men√ºplan</button>
    <button data-tab="alternatives">Alternativen</button>
    <button data-tab="distribution">Verteilung</button>
  </nav>

  <!-- Tabs -->
  <section id="users" class="active">
    <h2>Benutzer</h2>
    <p>Hier kannst du Benutzer hinzuf√ºgen, Aktivit√§t & Ziel einstellen.</p>
    <div id="user-list"></div>
    <button onclick="addUser()">+ Neuer Benutzer</button>
  </section>

  <section id="foods">
    <h2>Lebensmittel</h2>
    <p>W√§hle und verwalte typische Lebensmittel.</p>
    <input id="search" placeholder="Suche..." oninput="filterFoods(this.value)" />
    <div id="food-list"></div>
  </section>

  <section id="menu">
    <h2>Men√ºplan</h2>
    <p>Stelle deinen Tagesplan zusammen.</p>
    <div id="menu-output">Noch keine Auswahl.</div>
  </section>

  <section id="alternatives">
    <h2>Alternativen</h2>
    <p>Hier erscheinen Vorschl√§ge f√ºr nachhaltige oder vegetarische Alternativen.</p>
    <div id="alt-list"></div>
  </section>

  <section id="distribution">
    <h2>Verteilung</h2>
    <p>N√§hrstoffe werden auf Benutzer verteilt.</p>
    <div id="distribution-output">Noch keine Daten.</div>
  </section>

<!-- Stelle sicher, dass diese Zeile VOR dem Hauptscript steht: -->
<script src="foods.js"></script>

<script>
  // ---------------- Tabs ----------------
  const buttons = document.querySelectorAll("nav button");
  const sections = document.querySelectorAll("section");
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      buttons.forEach(b => b.classList.remove("active"));
      sections.forEach(s => s.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.add("active");
    });
  });

  // ---------------- State + Storage ----------------
  const state = {
    users: JSON.parse(localStorage.getItem("users") || "[]"),
    menu: JSON.parse(localStorage.getItem("menu") || '{"frueh":[],"mittag":[],"abend":[],"snack":[]}')
  };
  function save() {
    localStorage.setItem("users", JSON.stringify(state.users));
    localStorage.setItem("menu", JSON.stringify(state.menu));
  }

  // ---------------- Benutzer ----------------
  function addUser() {
    const name = prompt("Name des Benutzers?");
    if (!name) return;
    state.users.push({ name, ziel: "Erhalt", gewicht: 70 });
    save(); renderUsers();
  }
  function renderUsers() {
    const list = document.getElementById("user-list");
    if (!state.users.length) {
      list.innerHTML = `<div class="category">Noch keine Benutzer. Tippe auf ‚Äû+ Neuer Benutzer‚Äù.</div>`;
      return;
    }
    list.innerHTML = state.users
      .map(u => `<div>üë§ <strong>${u.name}</strong> ‚Äî ${u.ziel}, ${u.gewicht} kg</div>`)
      .join("");
  }
  renderUsers();
  window.addUser = addUser; // f√ºr Button im HTML

  // ---------------- Lebensmittel + Auswahl ----------------
  let foods = Array.isArray(window.foods) ? window.foods : [];

  function renderFoods(list = foods) {
    const container = document.getElementById("food-list");
    if (!list.length) {
      container.innerHTML = `<div class="category">Keine Lebensmittel gefunden.</div>`;
      return;
    }
    container.innerHTML = list.map(f => `
      <div class="food-item">
        <strong>${f.name}</strong><br>
        <span class="category">${f.category}</span> | ${(f.use||[]).join(", ")}
        <div style="margin-top:6px">
          <select class="mealSel">
            <option value="frueh">Fr√ºhst√ºck</option>
            <option value="mittag">Mittag</option>
            <option value="abend">Abend</option>
            <option value="snack">Snack</option>
          </select>
          <button class="addBtn" data-name="${f.name}">Hinzuf√ºgen</button>
        </div>
      </div>
    `).join("");

    // Buttons verbinden
    container.querySelectorAll(".addBtn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        const name = e.currentTarget.dataset.name;
        const sel = e.currentTarget.parentElement.querySelector(".mealSel");
        addToMenu(sel.value, name);
      });
    });
  }

  function filterFoods(q) {
    q = (q || "").toLowerCase();
    const filtered = foods.filter(f =>
      f.name.toLowerCase().includes(q) ||
      (f.category||"").toLowerCase().includes(q) ||
      (f.use||[]).join(",").toLowerCase().includes(q)
    );
    renderFoods(filtered);
  }
  // beim Laden einmal zeichnen (falls foods.js schon da ist)
  renderFoods();

  // ---------------- Men√ºplan ----------------
  function addToMenu(meal, name) {
    const list = state.menu[meal] || (state.menu[meal] = []);
    const found = list.find(it => it.name === name);
    if (found) found.qty += 1;
    else list.push({ name, qty: 1 });
    save(); renderMenu();
  }

  function changeQty(meal, name, delta) {
    const list = state.menu[meal]; if (!list) return;
    const it = list.find(x => x.name === name); if (!it) return;
    it.qty = Math.max(0, (it.qty || 0) + delta);
    if (it.qty === 0) {
      state.menu[meal] = list.filter(x => x.name !== name);
    }
    save(); renderMenu();
  }

  function removeItem(meal, name) {
    state.menu[meal] = (state.menu[meal] || []).filter(x => x.name !== name);
    save(); renderMenu();
  }

  function renderMeal(mealKey, title) {
    const box = document.createElement("div");
    const items = state.menu[mealKey] || [];
    box.innerHTML = `
      <h3>${title}</h3>
      ${items.length === 0 ? '<div class="category">Leer</div>' : ""}
      ${items.map(it => `
        <div class="food-item">
          <strong>${it.name}</strong>
          <div style="margin-top:6px">
            <button data-action="dec" data-meal="${mealKey}" data-name="${it.name}">‚àí</button>
            <span style="display:inline-block;min-width:32px;text-align:center">${it.qty || 1}√ó</span>
            <button data-action="inc" data-meal="${mealKey}" data-name="${it.name}">+</button>
            <button data-action="del" data-meal="${mealKey}" data-name="${it.name}" style="margin-left:6px">Entfernen</button>
          </div>
        </div>
      `).join("")}
    `;
    // Events
    box.querySelectorAll("button[data-action]").forEach(b=>{
      const act=b.dataset.action, meal=b.dataset.meal, name=b.dataset.name;
      b.addEventListener("click", ()=>{
        if(act==="inc") changeQty(meal,name, +1);
        if(act==="dec") changeQty(meal,name, -1);
        if(act==="del") removeItem(meal,name);
      });
    });
    return box;
  }

  function renderMenu() {
    const out = document.getElementById("menu-output");
    out.innerHTML = ""; // leeren
    out.appendChild(renderMeal("frueh","Fr√ºhst√ºck"));
    out.appendChild(renderMeal("mittag","Mittag"));
    out.appendChild(renderMeal("abend","Abend"));
    out.appendChild(renderMeal("snack","Snack"));
  }
  renderMenu();

  // Suche verbinden
  document.getElementById("search").addEventListener("input", (e)=> filterFoods(e.target.value));
</script>

</body>
</html>
